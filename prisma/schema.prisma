generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]   // Enabling the postgresqlExtensions preview feature to use pgvector extension
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  extensions = [vector] // tells postgres database to enabling pgvector extension 
}

// Each model is mapped to a table in our Postgres database - Neon

model User {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  imageUrl  String?
  firstName String?
  lastName  String?

  emailAddress String @unique
  credits      Int    @default(150)

  // credits is like for how many credits we want to give them to use

  // one credit means one file that we helps us you to processed out - 150 credits is the free tier that we allows user to have when creating project

  userToProjects UserToProject[]
}

model Project {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name      String
  githubUrl String

  deletedAt DateTime?

  userToProjects       UserToProject[]
  commits              Commit[]
  sourceCodeEmbeddings SourceCodeEmbedding[]
}

// Bridging Model for creating relationships between User To Project means A project have multiple users and A user can be a part of multiple projects - Many to Many relationship

model UserToProject {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId    String
  projectId String

  user User @relation(fields: [userId], references: [id])

  project Project @relation(fields: [projectId], references: [id])

  @@unique([userId, projectId]) // if we're a user we can only have a pairing of one unique userID , projectID : this the compound key that we are just creating
}


/*

  - using pgvector to store embeddings and 768 is the dimension of the embedding because of the particular embedding model that gemini provides us with having 768 dimensions

  - Unsupported is used because prisma does not support pgvector natively
  
  - and we have to use Unsupported to define custom types and vector is the type provided by pgvector extension

*/


// model/table to store source code embeddings

model SourceCodeEmbedding {
  id  String   @id @default(cuid())
  summaryEmbedding Unsupported("vector(768)")?

  sourceCode String
  fileName   String // file name of the source code file

  summary String

  // all of embedding belongs for a particular project because one project related to one github repository and one repository generated a list of source code embeddings

  projectId String
  project   Project @relation(fields: [projectId], references: [id])
}

// model to store commits : a project have list of commits which is an array of commits

model Commit {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projectId String
  project   Project @relation(fields: [projectId], references: [id])

  commitMessage      String
  commitHash         String
  commitAuthorName   String
  commitAuthorAvatar String
  commitDate         DateTime

  // ai summary
  summary String
}